[OpenGL PBR Tutorial](https://learnopengl.com/PBR/Theory)
# 1. 이론
물리 기반 렌더링은 물리적 원리를 기반으로 한 근사방식. 따라서 물리적 셰이딩이 아닌 물리 기반 셰이딩이라고 불린다.
## 1.1. 조건
1. 미세면(Microfacet) 표면 모델을 기반으로 해야한다.
2. 에너지를 보존해야 한다
3. 물리 기반 BRDF(Bidirectional Reflectance Distribution Function, 양방향 반사 분포 함수)를 사용해야 한다.
## 1.2. 특징
1. 조명 조건에 관계없이 재질이 일관되게 올바르게 보인다.
2. 비 PBR 에 비해 일반적으로 더 현실적인 결과를 제공한다.
![[Attachments/Pasted image 20250313092650.png]]
이 문서는 Disney에서 처음 연구하고 EpicGames에서 실시간 렌더링에 적용한 PBR 접근방식을 중점적으로 다룬다. 이 접근 방식은 **메탈릭 워크 플로우**를 기반으로하며, 대부분의 게임 엔진에서 널리 채택되었다.
# 2. 미세면(Microfacet) 모델
모든 PBR 기술은 미세면 이론을 기반으로 한다. 이 이론에 따르면, 어떤 표면이든 미세한 거울(Microfacets)로 이루어져 있어 이 들은 각각 완벽하게 반사하는 작은 거울처럼 동작한다.
표면의 거칠기에 따라 이 작은 거울들의 정렬 방식이 크게 달라질 수 있다.
![[Attachments/Pasted image 20250313092852.png]]
표면이 거칠수록, 각 미세면이 표면을 따라 더욱 무질서하게 정렬된다.
이러한 미세한 거울들의 정렬 방식이 조명 반사에 미치는 영향은 다음과 같다.
- 거친 표면
	- 입사하는 빛이 다양한 방향으로 산란(scatter)된다.
	- 그 결과, 넓게 퍼지는(흐릿하고 부드러운) 반사가 발생.
- 매끄러운 표면
	- 입사하는 빛이 거의 같은 방향으로 반사된다
	- 그 결과, 작고 날카로운 반사광이 나타난다.
![[Attachments/Pasted image 20250313093058.png]]
어떤 표면도 미세한 수준에서 완전히 매끄럽지는 않지만, 미세면이 픽셀 단위에서 구별할 수 없을 정도로 작기 때문에,표면의 거칠기(roughness) 파라미터를 사용하여 통계적으로 근사 할 수 있다.
포면의 거칠기에 따라 , 특정 벡터 **h** 에 정렬된 미세면의 비율을 계산할 수 있다.여기서 벡터**h**는 하프 벡터로, 조명 방향 **I** 와 시점(view) 방향 **v** 의 중간 벡터를 의미한다.
![[Attachments/Pasted image 20250313103203.png]]
- 미세면이 하프 벡터에 많이 정렬될수록, 반사는 더 강하고 날카로워 진다.
- 거칠기 파라미터(0 ~ 1)를 사용하여, 미세면의 정렬을 통계적으로 근사할 수 있다.
즉, **거칠기 값이 작을수록** 많은 미세면이 하프벡터에 정렬되어, **작고 선명한 반사**가 발생한다. 반대로, **거칠기 값이 클수록** 정렬이 불규칙해지며, **흐릿하고 넓게 퍼지는 반사**가 나타난다.
![[Attachments/Pasted image 20250313103423.png]]
# 3. 에너지 보존
미세면 근사는 에너지 보존 형태를 따릅니다. 즉, 방출되는 빛의 에너지는 입사하는 빛의 에너지를 초과해서는 안 됩니다(발광하는 표면 제외). 위의 이미지를 보면, 거칠기가 증가할수록 반사 영역이 넓어지지만, 밝기는 감소하는 것을 확인할 수 있습니다. 만약 반사 강도가 각 픽셀에서 동일하다면, 거친 표면은 더 많은 에너지를 방출하게 되어 에너지 보존 원칙을 위반하게 됩니다. 그렇기 때문에 매끄러운 표면에서는 반사가 더 강하게 보이고, 거친 표면에서는 더 희미하게 보입니다.

에너지 보존을 유지하려면 확산광과 반사광을 명확하게 구분해야 합니다. 빛이 표면에 닿는 순간, 일부는 굴절되고 일부는 반사됩니다. 반사된 부분은 표면에서 바로 튕겨 나가는 빛으로, 이를 반사광(Specular Light)이라고 합니다. 반면, 굴절된 빛은 표면 내부로 들어가 흡수되며, 이를 확산광(Diffuse Light)이라고 합니다.

여기에는 몇 가지 세부 사항이 있습니다. 굴절된 빛이 표면에 닿자마자 즉시 흡수되는 것은 아닙니다. 물리학적으로 빛은 계속 전진하는 에너지를 가진 빔으로 모델링할 수 있으며, 이 빛이 에너지를 잃는 방식은 충돌을 통해서입니다. 각 물질은 작은 입자로 이루어져 있으며, 이 입자들이 빛과 충돌하면서 에너지를 흡수하거나 일부 또는 전체 에너지를 열로 변환합니다.
![[Attachments/Pasted image 20250313104303.png]]